---
eip: 3652
title: Hierarchical NFT
author: Anton Bukov (@k06a)
discussions-to: https://github.com/ethereum/EIPs/issues/3653
status: Draft
type: Standards Track
category: ERC
created: 2021-07-13
updated: 2021-08-27
requires: 721
---

## Simple Summary

This standard defines a ERC-721 token called hierarchical token which can own other ERC-721, ERC-20, ERC-1155 and any other ownable assets.

## Abstract

This EIP-721 extension proposes to deploy Minimal Owned Proxy Contract during minting each token. Owner of the token will be able to perfrom arbitrary calls using this proxy directy.

## Motivation

Having hierarchical NFTs would allow next gen of NFT games. Imagine a hero owning a sword, with a spell applied to the sword of the hero:
```
Hero
 |
 +--- Sword
        |
        +--- Spell
```

## Specification

The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.

- Minimal ownable proxy contract implementation MAY be the following:

    ```solidity
    contract ERC3652Proxy {
        IERC721 immutable public token;
        uint256 immutable public tokenId;

        modifier onlyOwner {
            require(msg.sender == owner(), "ERC3652: access denied");
            _;
        }

        constructor(uint256 tokenId_) {
            token = IERC721(msg.sender);
            tokenId = tokenId_;
        }

        function owner() public view returns(address) {
            return token.ownerOf(tokenId);
        }

        function execute(address target, uint256 value, bytes calldata data) external payable onlyOwner returns(bool, bytes memory) {
            return target.call{ value: value }(data);
        }
    }
    ```

- EIP-3652 based smart contracts MAY use `tokenId` as salt for `CREATE2`. Function `_mint` of ERC-721 could be overriden as following:

    ```solidity
    function _mint(address to, uint256 tokenId) internal override {
        new ERC3652Proxy{salt: bytes32(tokenId)}(tokenId);
        super._mint(to, tokenId);
    }
    ```
    
- EIP-3652 based smart contracts MUST implement `addressOf` function returning proxy smart contract address by `tokenId`, it COULD be implemented as following:

    ```solidity
    function addressOf(uint256 tokenId) external view returns(address) {
        return Create2.computeAddress(
            bytes32(tokenId),
            keccak256(abi.encodePacked(type(ERC3652Proxy).creationCode, tokenId))
        );
    }
    ```

## Rationale

Should be useful for NFT projects.

## Backwards Compatibility

This ERC-3652 is fully backwards compatible with the ERC-721 standard.

## Implementation

https://github.com/k06a/ERC3652

## Security Considerations

Ideas?

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).